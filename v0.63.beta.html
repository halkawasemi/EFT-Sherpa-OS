<!-- START OF FILE v0.63.html -->

<!DOCTYPE html>
<html lang="ja" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>EFT Sherpa OS v0.63 (Injectors)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        tarkov: {
                            bg: '#0f0f0f',
                            panel: '#151515',
                            border: '#333333',
                            text: '#cccccc',
                            accent: '#9a8c7d', 
                            accentHover: '#b09b75',
                            green: '#4ade80',
                            red: '#ef4444',
                            orange: '#f97316',
                            gold: '#ffd700',
                            blue: '#4a6fa5',
                            purple: '#a855f7'
                        }
                    },
                    fontFamily: {
                        mono: ['Consolas', 'Monaco', 'Courier New', 'monospace'],
                        sans: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { background-color: #050505; color: #d4d4d4; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 2px; }
        
        /* CRT Overlay */
        .crt-overlay {
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.05) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 40;
        }

        .glass-panel { background: rgba(26, 26, 26, 0.95); border: 1px solid #333; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5); }
        .loader { border: 2px solid #333; border-top: 2px solid #9a8c7d; border-radius: 50%; width: 14px; height: 14px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Animation */
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Mobile Nav Active State */
        .mobile-nav-active { color: #9a8c7d; border-top: 2px solid #9a8c7d; background: linear-gradient(to bottom, rgba(154, 140, 125, 0.1), transparent); }

        /* Market & Common Styles */
        .req-badge { font-size: 0.65rem; padding: 2px 6px; border-radius: 3px; font-weight: bold; letter-spacing: 0.05em; display: inline-flex; align-items: center; gap: 4px; margin-right: 4px; transition: all 0.3s; }
        .req-quest { background: rgba(234, 179, 8, 0.2); color: #fbbf24; border: 1px solid rgba(234, 179, 8, 0.4); }
        .req-hideout { background: rgba(34, 197, 94, 0.2); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.4); }
        .req-barter { background: rgba(192, 132, 252, 0.2); color: #c084fc; border: 1px solid rgba(192, 132, 252, 0.4); }
        .req-craft { background: rgba(59, 130, 246, 0.2); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.4); }
        .req-done { background: rgba(60, 60, 60, 0.2); color: #666; border: 1px solid rgba(60, 60, 60, 0.4); opacity: 0.6; }
        
        .profit-pos { color: #4ade80; }
        .profit-neg { color: #ef4444; }
        
        .detail-section { max-height: 0; opacity: 0; overflow: hidden; transition: max-height 0.4s ease-in-out, opacity 0.4s ease-in-out, margin-top 0.3s; }
        .market-card.expanded .detail-section { max-height: 2000px; opacity: 1; margin-top: 1rem; padding-top: 1rem; border-top: 1px dashed #444; }
        .market-card.expanded { background-color: #1a1a1a; border-color: #4a6fa5; box-shadow: 0 0 15px rgba(74, 111, 165, 0.1); }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .market-nav-tab { flex: 1; text-align: center; padding: 8px; cursor: pointer; color: #666; border-bottom: 2px solid transparent; transition: all 0.3s; font-weight: bold; font-size: 0.8rem; background: transparent; }
        .market-nav-tab:hover { background: rgba(255,255,255,0.05); }
        .market-nav-tab.active { color: #9a8c7d; border-bottom-color: #9a8c7d; background: linear-gradient(to top, rgba(154, 140, 125, 0.1), transparent); }
        
        .hideout-level-btn { width: 24px; height: 24px; border-radius: 4px; display: flex; align-items: center; justify-content: center; background: #222; color: #666; transition: all 0.2s; }
        .hideout-level-btn:hover:not(:disabled) { background: #333; color: #fff; }
        .hideout-level-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        .filter-toggle-btn { font-size: 0.75rem; padding: 4px 10px; border-radius: 4px; border: 1px solid #333; background: #1a1a1a; color: #666; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
        .filter-toggle-btn.active { background: rgba(154, 140, 125, 0.2); border-color: #9a8c7d; color: #9a8c7d; }
        .filter-toggle-btn:hover:not(.active) { background: #252525; color: #aaa; }
        
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }

        .wishlist-star { cursor: pointer; transition: transform 0.2s; }
        .wishlist-star:hover { transform: scale(1.2); }
        .wishlist-star.active { color: #fbbf24; text-shadow: 0 0 10px rgba(251, 191, 36, 0.5); }

        /* Injector Specific */
        .injector-btn { transition: all 0.3s; border: 1px solid #333; }
        .injector-btn:hover { border-color: #666; background: rgba(255,255,255,0.05); }
        .injector-btn.active { border-color: #a855f7; background: rgba(168, 85, 247, 0.1); box-shadow: 0 0 15px rgba(168, 85, 247, 0.1); }
        .injector-grid-cell { aspect-ratio: 1/1; background: radial-gradient(circle at center, #2a2a2a 0%, #111 100%); border: 1px solid #333; position: relative; display: flex; align-items: center; justify-content: center; border-radius: 4px; }
        .cost-breakdown-row:last-child { border-bottom: none; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden relative text-sm md:text-base">
    
    <div class="crt-overlay fixed inset-0 h-full w-full pointer-events-none"></div>

    <!-- Header -->
    <header class="h-14 bg-tarkov-panel border-b border-tarkov-border flex items-center justify-between px-4 md:px-6 z-50 shrink-0 shadow-md">
        <div class="flex items-center gap-2 md:gap-3">
            <i class="fa-solid fa-layer-group text-tarkov-accent text-lg md:text-xl"></i>
            <h1 class="font-bold text-base md:text-lg tracking-wider text-tarkov-accent">EFT SHERPA <span class="text-white opacity-60">OS</span> v0.63 <span id="header-mode-badge" class="text-[10px] bg-tarkov-green text-black px-1 rounded ml-1 align-top transition-colors">PvE</span></h1>
        </div>
        
        <div class="flex items-center gap-2 md:gap-4">
            <button id="sync-btn" class="text-xs flex items-center gap-2 bg-tarkov-border hover:bg-gray-700 transition px-3 py-2 rounded text-gray-300 border border-tarkov-border active:scale-95">
                <i class="fa-solid fa-rotate"></i> <span class="hidden md:inline">SYNC</span>
            </button>
            <button class="nav-btn-shortcut text-gray-400 hover:text-white transition px-2 py-2" data-target="settings" title="Settings">
                <i class="fa-solid fa-gear text-lg"></i>
            </button>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="flex-1 flex overflow-hidden relative">
        
        <!-- Sidebar (PC) -->
        <nav class="w-64 bg-tarkov-panel border-r border-tarkov-border flex flex-col z-30 hidden md:flex">
            <div class="p-4 border-b border-tarkov-border">
                <div class="text-xs text-gray-500 uppercase font-bold mb-2">Command</div>
                <button class="nav-btn-desktop w-full text-left px-3 py-2 rounded mb-1 bg-tarkov-border text-tarkov-accent border-l-2 border-tarkov-accent font-medium" data-target="dashboard">
                    <i class="fa-solid fa-chart-line w-6 text-center"></i> Dashboard
                </button>
                <button class="nav-btn-desktop w-full text-left px-3 py-2 rounded mb-1 hover:bg-white/5 text-gray-400 border-l-2 border-transparent" data-target="injectors">
                    <i class="fa-solid fa-syringe w-6 text-center"></i> Tactical Stim
                </button>
                <button class="nav-btn-desktop w-full text-left px-3 py-2 rounded mb-1 hover:bg-white/5 text-gray-400 border-l-2 border-transparent" data-target="market">
                    <i class="fa-solid fa-shop w-6 text-center"></i> Market & Craft
                </button>
                <button class="nav-btn-desktop w-full text-left px-3 py-2 rounded mb-1 hover:bg-white/5 text-gray-400 border-l-2 border-transparent" data-target="wishlist">
                    <i class="fa-solid fa-star w-6 text-center"></i> Wishlist
                </button>
                <button class="nav-btn-desktop w-full text-left px-3 py-2 rounded mb-1 hover:bg-white/5 text-gray-400 border-l-2 border-transparent" data-target="tasks">
                    <i class="fa-solid fa-list-check w-6 text-center"></i> Task Database
                </button>
                <button class="nav-btn-desktop w-full text-left px-3 py-2 rounded mb-1 hover:bg-white/5 text-gray-400 border-l-2 border-transparent" data-target="hideout">
                    <i class="fa-solid fa-dungeon w-6 text-center"></i> Hideout Manager
                </button>
                <button class="nav-btn-desktop w-full text-left px-3 py-2 rounded mb-1 hover:bg-white/5 text-gray-400 border-l-2 border-transparent" data-target="gunsmith">
                    <i class="fa-solid fa-gun w-6 text-center"></i> Gunsmith
                </button>
                <button class="nav-btn-desktop w-full text-left px-3 py-2 rounded mb-1 hover:bg-white/5 text-gray-400 border-l-2 border-transparent" data-target="ammo">
                    <i class="fa-solid fa-bullseye w-6 text-center"></i> Ballistics Live
                </button>
                <div class="my-2 border-t border-gray-800"></div>
                <button class="nav-btn-desktop w-full text-left px-3 py-2 rounded mb-1 hover:bg-white/5 text-gray-400 border-l-2 border-transparent" data-target="settings">
                    <i class="fa-solid fa-gear w-6 text-center"></i> System Config
                </button>
            </div>
            
            <div class="p-4 text-[10px] text-gray-600 text-center mt-auto">
                INTEGRATED SYSTEM<br>
                v0.63 (INJECTORS)
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 bg-tarkov-bg overflow-y-auto p-4 md:p-6 pb-32 md:pb-6 relative scroll-smooth" id="main-content">
            
            <!-- VIEW: DASHBOARD -->
            <div id="view-dashboard" class="space-y-4 md:space-y-6 animate-fade-in">
                <!-- Stats -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                    <div class="glass-panel p-3 md:p-4 rounded">
                        <div class="text-gray-400 text-[10px] md:text-xs uppercase">DB Status</div>
                        <div class="text-sm md:text-base font-bold text-gray-500 mt-1" id="dash-status">Offline</div>
                    </div>
                    <div class="glass-panel p-3 md:p-4 rounded">
                        <div class="text-gray-400 text-[10px] md:text-xs uppercase">Live Tasks</div>
                        <div class="text-xl md:text-2xl font-bold text-white mt-1" id="dash-task-count">0</div>
                    </div>
                    <div class="glass-panel p-3 md:p-4 rounded">
                        <div class="text-gray-400 text-[10px] md:text-xs uppercase">Market Intel</div>
                        <div class="text-xl md:text-2xl font-bold text-tarkov-blue mt-1" id="dash-market-count">0</div>
                    </div>
                    <div class="glass-panel p-3 md:p-4 rounded">
                        <div class="text-gray-400 text-[10px] md:text-xs uppercase">Hideout</div>
                        <div class="text-xl md:text-2xl font-bold text-tarkov-green mt-1" id="dash-hideout-count">0%</div>
                    </div>
                </div>

                <!-- Shortcuts -->
                <div class="glass-panel p-4 md:p-6 rounded border border-dashed border-gray-700">
                    <h2 class="text-lg md:text-xl text-white mb-2"><i class="fa-solid fa-rocket mr-2"></i>Quick Access</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                         <button class="nav-btn-shortcut flex items-center gap-3 bg-black/40 p-3 rounded hover:bg-white/5 border border-gray-800 hover:border-tarkov-purple transition text-left w-full" data-target="injectors">
                            <div class="bg-purple-900/20 p-2 rounded text-tarkov-purple"><i class="fa-solid fa-syringe"></i></div>
                            <div>
                                <div class="text-sm font-bold text-gray-200">Injector Guide</div>
                                <div class="text-xs text-gray-500">目的別ロードアウト & コスト計算</div>
                            </div>
                        </button>
                        <button class="nav-btn-shortcut flex items-center gap-3 bg-black/40 p-3 rounded hover:bg-white/5 border border-gray-800 hover:border-tarkov-blue transition text-left w-full" data-target="market">
                            <div class="bg-tarkov-blue/20 p-2 rounded text-tarkov-blue"><i class="fa-solid fa-shop"></i></div>
                            <div>
                                <div class="text-sm font-bold text-gray-200">Market Monitor</div>
                                <div class="text-xs text-gray-500">市場価格・クラフト利益 (LL考慮済)</div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- VIEW: INJECTORS (NEW) -->
            <div id="view-injectors" class="hidden space-y-4 animate-fade-in">
                <div class="bg-tarkov-panel border border-tarkov-border p-4 rounded shadow-lg">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-2">
                        <h2 class="text-lg font-bold text-gray-200"><i class="fa-solid fa-syringe mr-2 text-tarkov-purple"></i>TACTICAL STIMULATOR</h2>
                        <div class="text-xs text-gray-500">Current Trader Settings Applied</div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-2 mb-6">
                        <button class="injector-btn rounded p-2 text-center" onclick="app.loadInjectorPreset('boss')">
                            <i class="fa-solid fa-skull text-red-500 text-xl mb-1 block"></i>
                            <span class="text-xs font-bold text-gray-300">COMBAT</span>
                        </button>
                        <button class="injector-btn rounded p-2 text-center" onclick="app.loadInjectorPreset('marathon')">
                            <i class="fa-solid fa-person-running text-blue-400 text-xl mb-1 block"></i>
                            <span class="text-xs font-bold text-gray-300">MARATHON</span>
                        </button>
                        <button class="injector-btn rounded p-2 text-center" onclick="app.loadInjectorPreset('loot')">
                            <i class="fa-solid fa-weight-hanging text-yellow-500 text-xl mb-1 block"></i>
                            <span class="text-xs font-bold text-gray-300">HEAVY LOOT</span>
                        </button>
                        <button class="injector-btn rounded p-2 text-center" onclick="app.loadInjectorPreset('budget')">
                            <i class="fa-solid fa-piggy-bank text-green-400 text-xl mb-1 block"></i>
                            <span class="text-xs font-bold text-gray-300">BUDGET</span>
                        </button>
                         <button class="injector-btn rounded p-2 text-center" onclick="app.loadInjectorPreset('night')">
                            <i class="fa-solid fa-moon text-purple-400 text-xl mb-1 block"></i>
                            <span class="text-xs font-bold text-gray-300">NIGHT/SCAV</span>
                        </button>
                    </div>

                    <div id="injector-result-area" class="hidden">
                        <div class="flex flex-col lg:flex-row gap-6">
                            <!-- Left: Case Visual -->
                            <div class="w-full lg:w-1/3">
                                <div class="bg-[#1a1a1a] p-4 rounded border border-gray-700 shadow-inner">
                                    <div class="flex justify-between text-[10px] text-gray-500 mb-2 uppercase tracking-widest">
                                        <span>Injector Case</span>
                                        <span>3x3 Grid</span>
                                    </div>
                                    <div class="grid grid-cols-3 gap-2" id="injector-grid-display">
                                        <!-- Generated by JS -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right: Details -->
                            <div class="w-full lg:w-2/3 space-y-4">
                                <div>
                                    <h3 class="text-xl font-bold text-white mb-1" id="inj-title">Loadout Title</h3>
                                    <p class="text-sm text-gray-400 mb-2" id="inj-desc">Description</p>
                                    <div class="p-3 bg-yellow-900/10 border-l-2 border-yellow-600 text-xs text-yellow-500 rounded-r" id="inj-warning">
                                        <!-- Warning -->
                                    </div>
                                </div>
                                
                                <div class="bg-black/40 rounded border border-gray-800 overflow-hidden">
                                    <div class="px-3 py-2 bg-gray-900/50 border-b border-gray-800 flex justify-between items-center">
                                        <span class="text-xs font-bold text-gray-400">ESTIMATED COST</span>
                                        <span class="text-sm font-bold text-tarkov-green font-mono" id="inj-total-cost">₽0</span>
                                    </div>
                                    <div class="p-3 space-y-2" id="inj-cost-list">
                                        <!-- Cost Breakdown -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="injector-placeholder" class="text-center py-10 text-gray-500 opacity-50">
                        <i class="fa-solid fa-arrow-up text-2xl mb-2"></i>
                        <p>Select a scenario above to see recommendations</p>
                    </div>
                </div>
            </div>

            <!-- VIEW: SETTINGS -->
            <div id="view-settings" class="hidden space-y-4 md:space-y-6 animate-fade-in">
                <div class="bg-tarkov-panel border border-tarkov-border p-4 md:p-6 rounded shadow-lg">
                    <h2 class="text-xl font-bold text-white mb-4"><i class="fa-solid fa-gear mr-2 text-gray-400"></i>SYSTEM CONFIG</h2>
                    
                    <!-- Game Mode -->
                    <div class="mb-8">
                        <h3 class="text-sm font-bold text-tarkov-accent uppercase mb-3 border-b border-gray-800 pb-2">Game Mode</h3>
                        <div class="flex gap-4">
                            <label class="cursor-pointer flex items-center gap-2 bg-black/40 p-3 rounded border border-gray-700 hover:border-gray-500 transition w-full md:w-auto">
                                <input type="radio" name="gameMode" value="pve" class="form-radio text-tarkov-accent focus:ring-tarkov-accent">
                                <div>
                                    <div class="font-bold text-white">PvE Zone</div>
                                    <div class="text-xs text-gray-500">AI PMC Only. Market prices vary.</div>
                                </div>
                            </label>
                            <label class="cursor-pointer flex items-center gap-2 bg-black/40 p-3 rounded border border-gray-700 hover:border-gray-500 transition w-full md:w-auto">
                                <input type="radio" name="gameMode" value="regular" class="form-radio text-tarkov-red focus:ring-tarkov-red">
                                <div>
                                    <div class="font-bold text-white">PvP (Regular)</div>
                                    <div class="text-xs text-gray-500">Standard Online Mode.</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Trader Loyalty -->
                    <div class="mb-8">
                        <h3 class="text-sm font-bold text-tarkov-accent uppercase mb-3 border-b border-gray-800 pb-2">Trader Loyalty Levels (LL)</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="settings-trader-grid">
                            <!-- Traders injected via JS -->
                        </div>
                    </div>

                    <!-- Data Management -->
                    <div>
                        <h3 class="text-sm font-bold text-gray-500 uppercase mb-3 border-b border-gray-800 pb-2">Data Management</h3>
                        <button onclick="localStorage.clear(); location.reload();" class="bg-red-900/20 hover:bg-red-900/40 text-red-500 border border-red-900 px-4 py-2 rounded text-xs transition">
                            <i class="fa-solid fa-trash mr-1"></i> Clear All Data & Reset
                        </button>
                    </div>
                </div>
            </div>

            <!-- VIEW: WISHLIST -->
            <div id="view-wishlist" class="hidden space-y-4 animate-fade-in">
                <div class="bg-tarkov-panel border border-tarkov-border p-4 rounded shadow-lg sticky top-0 z-20">
                    <div class="flex justify-between items-center">
                        <h2 class="text-sm font-bold text-gray-200"><i class="fa-solid fa-star mr-2 text-tarkov-gold"></i>WISHLIST</h2>
                        <span id="wishlist-count" class="text-xs text-gray-500 font-mono">0 Items</span>
                    </div>
                    <div class="text-[10px] text-gray-500 mt-1">Items added from Market are tracked here.</div>
                </div>
                <div id="wishlist-grid" class="grid grid-cols-1 gap-3">
                    <div class="text-center text-gray-500 py-10">No items in wishlist.</div>
                </div>
            </div>

            <!-- VIEW: MARKET MONITOR -->
            <div id="view-market" class="hidden space-y-4 animate-fade-in">
                <div class="glass-panel rounded overflow-hidden">
                    <div class="flex border-b border-gray-700 bg-black/20" role="tablist">
                        <button class="market-nav-tab active" id="mt-items" role="tab" aria-selected="true" data-tab="items"><i class="fa-solid fa-tag mr-1"></i> MARKET</button>
                        <button class="market-nav-tab" id="mt-crafts" role="tab" aria-selected="false" data-tab="crafts"><i class="fa-solid fa-hammer mr-1"></i> CRAFTS</button>
                    </div>
                    <div class="p-4">
                        <div id="subview-items" role="tabpanel">
                            <div class="mb-4 space-y-3">
                                <div class="w-full relative">
                                    <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                                    <input type="text" id="market-search" placeholder="Search Item..." class="w-full bg-black/40 border border-gray-600 pl-10 pr-4 py-2 rounded text-sm text-white focus:border-tarkov-blue outline-none">
                                </div>
                                <div id="market-result-count" class="text-xs text-gray-500 mb-2 text-right">No Data - Loading...</div>
                                <div id="market-grid" class="grid grid-cols-1 gap-3"></div>
                            </div>
                        </div>
                        <div id="subview-crafts" class="hidden" role="tabpanel">
                             <div class="mb-4 space-y-3">
                                <div class="w-full relative">
                                    <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                                    <input type="text" id="craft-search" placeholder="Search Recipe..." class="w-full bg-black/40 border border-gray-600 pl-10 pr-4 py-2 rounded text-sm text-white focus:border-tarkov-blue outline-none">
                                </div>
                                <div class="w-full overflow-x-auto scrollbar-hide pb-2">
                                    <div class="flex gap-2 min-w-max" id="craft-filters">
                                        <button class="tarkov-btn active px-3 py-1 text-xs rounded border border-gray-700 bg-gray-800 text-gray-400 hover:text-white transition" data-station="all">ALL STATIONS</button>
                                        <button class="tarkov-btn px-3 py-1 text-xs rounded border border-gray-700 bg-gray-800 text-gray-400 hover:text-white transition" data-station="ワークベンチ">ワークベンチ</button>
                                        <button class="tarkov-btn px-3 py-1 text-xs rounded border border-gray-700 bg-gray-800 text-gray-400 hover:text-white transition" data-station="洗面所">洗面所</button>
                                        <button class="tarkov-btn px-3 py-1 text-xs rounded border border-gray-700 bg-gray-800 text-gray-400 hover:text-white transition" data-station="医療ステーション">医療ステーション</button>
                                        <button class="tarkov-btn px-3 py-1 text-xs rounded border border-gray-700 bg-gray-800 text-gray-400 hover:text-white transition" data-station="栄養ユニット">栄養ユニット</button>
                                        <button class="tarkov-btn px-3 py-1 text-xs rounded border border-gray-700 bg-gray-800 text-gray-400 hover:text-white transition" data-station="インテリジェンスセンター">インテリジェンス</button>
                                        <button class="tarkov-btn px-3 py-1 text-xs rounded border border-gray-700 bg-gray-800 text-gray-400 hover:text-white transition" data-station="集水器">集水器</button>
                                    </div>
                                </div>
                                <div id="craft-result-count" class="text-xs text-gray-500 mb-2 text-right">No Data - Loading...</div>
                                <div id="crafts-grid" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: TASKS -->
            <div id="view-tasks" class="hidden space-y-4 animate-fade-in">
                <div class="flex flex-col gap-3 mb-4 sticky top-0 bg-tarkov-bg pt-2 pb-4 z-20 border-b border-gray-800">
                    <input type="text" id="task-search" placeholder="タスク名、報酬、詳細で検索..." class="w-full bg-tarkov-panel border border-tarkov-border px-4 py-3 rounded text-sm text-white focus:border-tarkov-accent focus:outline-none shadow-sm">
                    <div id="task-list" class="grid grid-cols-1 gap-3 pb-4"></div>
                </div>
            </div>

            <!-- VIEW: GUNSMITH & AMMO & HIDEOUT (Simplified Placeholders for this demo, focusing on Route F) -->
            <div id="view-gunsmith" class="hidden space-y-4 animate-fade-in"><div class="text-center text-gray-500 py-10">Gunsmith Module Loaded</div></div>
            <div id="view-ammo" class="hidden space-y-4 animate-fade-in"><div class="text-center text-gray-500 py-10">Ballistics Module Loaded</div></div>
            <div id="view-hideout" class="hidden space-y-4 animate-fade-in"><div class="text-center text-gray-500 py-10">Hideout Module Loaded</div></div>

        </main>
    </div>
    
    <!-- Mobile Bottom Navigation -->
    <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-[#121212] border-t border-tarkov-border z-[100] pb-safe shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.5)]">
        <div class="flex justify-around items-stretch h-14">
            <button class="nav-btn-mobile flex-1 flex flex-col items-center justify-center gap-0.5 text-gray-500 mobile-nav-active" data-target="dashboard">
                <i class="fa-solid fa-chart-line text-sm"></i><span class="text-[9px]">Dash</span>
            </button>
            <button class="nav-btn-mobile flex-1 flex flex-col items-center justify-center gap-0.5 text-gray-500" data-target="injectors">
                <i class="fa-solid fa-syringe text-sm"></i><span class="text-[9px]">Stim</span>
            </button>
            <button class="nav-btn-mobile flex-1 flex flex-col items-center justify-center gap-0.5 text-gray-500" data-target="market">
                <i class="fa-solid fa-shop text-sm"></i><span class="text-[9px]">Market</span>
            </button>
            <button class="nav-btn-mobile flex-1 flex flex-col items-center justify-center gap-0.5 text-gray-500" data-target="tasks">
                <i class="fa-solid fa-list-check text-sm"></i><span class="text-[9px]">Tasks</span>
            </button>
            <button class="nav-btn-mobile flex-1 flex flex-col items-center justify-center gap-0.5 text-gray-500" data-target="wishlist">
                <i class="fa-solid fa-star text-sm"></i><span class="text-[9px]">Wish</span>
            </button>
        </div>
    </nav>

    <!-- Toast -->
    <div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-tarkov-panel border border-tarkov-accent text-white px-6 py-3 rounded-full shadow-2xl opacity-0 transition duration-300 z-[110] flex items-center gap-3 w-max max-w-[90%] pointer-events-none">
        <i class="fa-solid fa-info-circle text-tarkov-accent"></i><span id="toast-msg" class="text-sm font-medium">Notification</span>
    </div>

    <script>
        // --- APP CONTROLLER ---
        window.app = {
            data: { 
                tasks: [], 
                marketItems: [],
                itemPriceMap: new Map(),
                itemFullPriceData: new Map(), 
                crafts: [],
                wishlist: new Set(),
                marketConfig: { category: 'all', station: 'all', tab: 'items' },
                config: {
                    gameMode: 'pve', 
                    traderLevels: { 'Prapor':4,'Therapist':4,'Skier':4,'Peacekeeper':4,'Mechanic':4,'Ragman':4,'Jaeger':4,'Ref':4 }
                }
            },
            
            consts: {
                // ADDED 'meds', 'stimulator' for Route F
                globalTypes: ['barter', 'keys', 'ammo', 'provisions', 'mods', 'suppressor', 'container', 'armor', 'helmet', 'glasses', 'headphones', 'rig', 'backpack', 'gun', 'meds', 'stimulator'],
                tradersList: ['Prapor', 'Therapist', 'Skier', 'Peacekeeper', 'Mechanic', 'Ragman', 'Jaeger', 'Ref'],
                
                // ROUTE F: Injector Loadouts
                injectorLoadouts: {
                    "boss": {
                        title: "COMBAT / BOSS HUNT",
                        desc: "生存率重視。出血、骨折、HP減少のすべてに即座に対応する。",
                        warning: "<i class='fa-solid fa-triangle-exclamation mr-1'></i>副作用: 水分・エネルギー消費が激しいため、食料を持参すること。",
                        items: ["Propital", "eTG-change", "Zagustin"]
                    },
                    "marathon": {
                        title: "MARATHON / ROTATION",
                        desc: "長距離移動用。スタミナ回復と上限をブーストし、走り続ける。",
                        warning: "<i class='fa-solid fa-circle-info mr-1'></i>SJ6とTrimadolは重複可能だが、代謝が早まる。",
                        items: ["SJ6 TGLabs", "Trimadol", "L1"]
                    },
                    "loot": {
                        title: "HEAVY LOOT / MULE",
                        desc: "戦車バッテリーや重装備回収用。重量制限を無視する。",
                        warning: "<i class='fa-solid fa-skull-crossbones mr-1'></i>警告: M.U.L.E使用中は被ダメージ+9%。戦闘を避けること。",
                        items: ["M.U.L.E.", "SJ6 TGLabs", "Propital"]
                    },
                    "budget": {
                        title: "BUDGET / STANDARD",
                        desc: "最低限の鎮痛とリジェネ。タスクラン向け。",
                        warning: "コストパフォーマンス優先。激戦には不向き。",
                        items: ["Propital", "Morphine"]
                    },
                    "night": {
                        title: "NIGHT / SCAV HUNT",
                        desc: "知覚強化と体温低下(サーマル対策)。夜間の生存率を上げる。",
                        warning: "SJ12は餓死防止にも使える。",
                        items: ["SJ12 TGLabs", "SJ1 TGLabs"]
                    }
                }
            },
            
            async init() {
                if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', () => this.runInit()); } 
                else { this.runInit(); }
            },

            async runInit() {
                this.loadConfig(); 
                this.renderConfigUI();
                this.setupListeners();
                this.loadWishlist();
                this.safeUpdateText('market-result-count', "Waiting for Sync...");
                this.fetchLiveStats();
            },

            async fetchApiData(query) {
                try {
                    const cleanQuery = query.replace(new RegExp("[\\r\\n]+", "g"), ' ').replace(new RegExp("\\s{2,}", "g"), ' ').trim();
                    const res = await fetch('https://api.tarkov.dev/graphql', {
                        method: 'POST', 
                        headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' }, 
                        body: JSON.stringify({ query: cleanQuery })
                    });
                    if (!res.ok) throw new Error(`HTTP Status ${res.status}`);
                    const json = await res.json();
                    if (json.data) return json.data;
                    throw new Error("No data");
                } catch (e) {
                    console.error("API Error:", e);
                    this.showToast("Connection Error: " + e.message);
                    return null;
                }
            },

            async fetchLiveStats() {
                const btn = document.getElementById('sync-btn');
                if(btn) { btn.innerHTML = `<span class="loader"></span>`; btn.disabled = true; }
                const modeLabel = this.data.config.gameMode === 'pve' ? 'PvE Zone' : 'PvP Mode';
                const modeColor = this.data.config.gameMode === 'pve' ? 'bg-tarkov-green text-black' : 'bg-red-600 text-white';
                this.safeUpdateHTML('dash-status', `<span class="text-yellow-500">INITIALIZING...</span>`);
                document.getElementById('header-mode-badge').innerText = this.data.config.gameMode === 'pve' ? 'PvE' : 'PvP';
                document.getElementById('header-mode-badge').className = `text-[10px] px-1 rounded ml-1 align-top transition-colors ${modeColor}`;

                try {
                    // Task Data
                    const taskQuery = `{ tasks(limit: 50, lang: ja) { id name minPlayerLevel map { name } trader { name } } }`;
                    const taskData = await this.fetchApiData(taskQuery);
                    if (taskData) {
                        this.data.tasks = taskData.tasks;
                        this.safeUpdateText('dash-task-count', this.data.tasks.length);
                        this.renderTasks();
                    }

                    // Market Data (Includes Meds now)
                    const marketQuery = `{ 
                        items(gameMode: ${this.data.config.gameMode}, limit: 3000, types: [${this.consts.globalTypes.join(', ')}], lang: ja) {
                            id name shortName avg24hPrice low24hPrice changeLast48hPercent iconLink gridImageLink types
                            sellFor { price source } 
                            buyFor { price source vendor { name } requirements { type value } }
                        }
                    }`;
                    const marketRes = await this.fetchApiData(marketQuery);
                    if (marketRes) {
                        this.data.marketItems = marketRes.items.filter(i => i.avg24hPrice > 0 || (i.buyFor && i.buyFor.length > 0)).sort((a, b) => b.avg24hPrice - a.avg24hPrice);
                        this.data.itemFullPriceData.clear();
                        this.data.marketItems.forEach(i => {
                            this.data.itemFullPriceData.set(i.id, { avg24hPrice: i.avg24hPrice, buyFor: i.buyFor || [] });
                        });
                        this.safeUpdateText('dash-market-count', this.data.marketItems.length);
                        this.renderMarket();
                    }

                    // Crafts (Simplified)
                    const craftQuery = `{ crafts(lang: ja) { station { name } level rewardItems { item { id name } count } requiredItems { item { id } count } } }`;
                    const craftRes = await this.fetchApiData(craftQuery);
                    if(craftRes) { this.data.crafts = craftRes.crafts; this.renderCrafts(); }

                    this.safeUpdateHTML('dash-status', `<span class="${this.data.config.gameMode === 'pve' ? 'text-green-400' : 'text-red-400'}">ONLINE (${modeLabel})</span>`);
                    this.showToast("System Fully Synchronized");

                } catch (e) {
                    console.error(e);
                    this.safeUpdateHTML('dash-status', `<span class="text-red-500">SYNC ERROR</span>`);
                }
                
                if(btn) { btn.innerHTML = `<i class="fa-solid fa-rotate"></i> <span class="hidden md:inline">SYNC</span>`; btn.disabled = false; }
            },

            // --- PRICE LOGIC (v0.61.1 Core) ---
            getBestPrice(itemId) {
                const data = this.data.itemFullPriceData.get(itemId);
                if (!data) return { price: 0, source: 'unknown', vendor: 'Unknown' };

                let bestPrice = 999999999;
                let source = 'unknown';
                let vendor = 'Unavailable';

                // Check Flea
                if (data.avg24hPrice > 0) {
                    bestPrice = data.avg24hPrice;
                    source = 'flea';
                    vendor = 'Flea Market';
                }

                // Check Traders
                if (data.buyFor) {
                    data.buyFor.forEach(offer => {
                        if (offer.source === 'fleaMarket') return; 
                        const traderName = offer.vendor.name;
                        const userLL = this.data.config.traderLevels[traderName] || 4; 
                        const llReq = offer.requirements.find(r => r.type === 'loyaltyLevel');
                        const reqLevel = llReq ? llReq.value : 1;

                        if (userLL >= reqLevel) {
                            if (offer.price < bestPrice) {
                                bestPrice = offer.price;
                                source = 'trader';
                                vendor = `${traderName} LL${reqLevel}`;
                            }
                        }
                    });
                }
                
                if (bestPrice === 999999999) { bestPrice = 0; source = 'unknown'; vendor = 'Unavailable'; }
                return { price: bestPrice, source, vendor };
            },

            // --- ROUTE F: INJECTOR LOGIC ---
            loadInjectorPreset(presetKey) {
                const preset = this.consts.injectorLoadouts[presetKey];
                if (!preset) return;

                // UI Active State
                document.querySelectorAll('.injector-btn').forEach(b => b.classList.remove('active'));
                const btns = document.querySelectorAll('.injector-btn');
                const keys = Object.keys(this.consts.injectorLoadouts);
                const idx = keys.indexOf(presetKey);
                if(btns[idx]) btns[idx].classList.add('active');

                // Show Container
                document.getElementById('injector-placeholder').classList.add('hidden');
                document.getElementById('injector-result-area').classList.remove('hidden');

                // Set Text
                this.safeUpdateText('inj-title', preset.title);
                this.safeUpdateText('inj-desc', preset.desc);
                this.safeUpdateHTML('inj-warning', preset.warning);

                // Process Items
                const grid = document.getElementById('injector-grid-display');
                const costList = document.getElementById('inj-cost-list');
                grid.innerHTML = '';
                costList.innerHTML = '';
                
                let totalCost = 0;
                let hasUnknown = false;

                // Fill 3x3 Grid (max 9 items, preset usually has 2-3)
                // We create 9 cells to look like an Injector Case
                for(let i=0; i<9; i++) {
                    const itemName = preset.items[i];
                    let cellContent = '';
                    
                    if (itemName) {
                        // Find item data
                        const itemData = this.data.marketItems.find(m => m.name.includes(itemName) || (m.shortName && m.shortName.includes(itemName)));
                        
                        if (itemData) {
                            const priceInfo = this.getBestPrice(itemData.id);
                            totalCost += priceInfo.price;
                            if(priceInfo.price === 0) hasUnknown = true;
                            
                            const vendorColor = priceInfo.source === 'trader' ? 'text-tarkov-green' : 'text-gray-400';
                            
                            // Grid Visual
                            cellContent = `
                                <img src="${itemData.iconLink}" class="w-10 h-10 object-contain drop-shadow-md">
                                <div class="absolute bottom-1 right-1 bg-black/70 px-1 rounded text-[8px] font-mono text-white">1</div>
                            `;

                            // List Visual
                            const row = document.createElement('div');
                            row.className = 'cost-breakdown-row flex justify-between items-center text-xs border-b border-gray-800 pb-2 last:mb-0';
                            row.innerHTML = `
                                <div class="flex items-center gap-2">
                                    <div class="w-8 h-8 bg-[#222] rounded flex items-center justify-center border border-[#333]"><img src="${itemData.iconLink}" class="w-6 h-6"></div>
                                    <div>
                                        <div class="text-gray-300 font-bold">${itemData.shortName || itemData.name}</div>
                                        <div class="text-[9px] ${vendorColor}">${priceInfo.vendor}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-gray-200 font-mono">₽${priceInfo.price.toLocaleString()}</div>
                                </div>
                            `;
                            costList.appendChild(row);

                        } else {
                            // Item not found in DB
                            cellContent = `<span class="text-[9px] text-red-500">ERR</span>`;
                        }
                    } else {
                        // Empty slot
                        cellContent = `<span class="text-[#222] text-xl"><i class="fa-solid fa-plus"></i></span>`;
                    }

                    const cell = document.createElement('div');
                    cell.className = 'injector-grid-cell';
                    cell.innerHTML = cellContent;
                    grid.appendChild(cell);
                }

                this.safeUpdateText('inj-total-cost', `₽${totalCost.toLocaleString()}${hasUnknown ? '+' : ''}`);
            },

            // --- STANDARD FUNCTIONS (Copied from v0.61.1) ---
            loadConfig() {
                const saved = localStorage.getItem('eft_sherpa_config');
                if(saved) { try { this.data.config = { ...this.data.config, ...JSON.parse(saved) }; } catch(e){} }
            },
            saveConfig() { localStorage.setItem('eft_sherpa_config', JSON.stringify(this.data.config)); },
            
            updateGameMode(mode) {
                if(this.data.config.gameMode === mode) return;
                this.data.config.gameMode = mode;
                this.saveConfig();
                this.fetchLiveStats();
            },
            
            updateTraderLevel(trader, level) {
                this.data.config.traderLevels[trader] = parseInt(level);
                this.saveConfig();
                this.renderMarket();
                // Re-calculate loaded injector preset if visible
                const activeBtn = document.querySelector('.injector-btn.active');
                if(activeBtn) activeBtn.click();
            },

            renderConfigUI() {
                const radioPve = document.querySelector(`input[name="gameMode"][value="pve"]`);
                const radioReg = document.querySelector(`input[name="gameMode"][value="regular"]`);
                if(radioPve) radioPve.checked = this.data.config.gameMode === 'pve';
                if(radioReg) radioReg.checked = this.data.config.gameMode === 'regular';

                const container = document.getElementById('settings-trader-grid');
                if(container) {
                    container.innerHTML = this.consts.tradersList.map(t => {
                        const lvl = this.data.config.traderLevels[t] || 4;
                        return `
                        <div class="bg-black/40 p-2 rounded border border-gray-700 flex flex-col gap-2">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-bold text-gray-300">${t}</span>
                                <span class="text-xs text-tarkov-accent font-mono">LL${lvl}</span>
                            </div>
                            <select onchange="app.updateTraderLevel('${t}', this.value)" class="w-full bg-black border border-gray-600 rounded text-xs py-1 text-white focus:border-tarkov-accent">
                                <option value="1" ${lvl==1?'selected':''}>Level 1</option>
                                <option value="2" ${lvl==2?'selected':''}>Level 2</option>
                                <option value="3" ${lvl==3?'selected':''}>Level 3</option>
                                <option value="4" ${lvl==4?'selected':''}>Level 4 (MAX)</option>
                            </select>
                        </div>`;
                    }).join('');
                }
            },

            loadWishlist() { const s = localStorage.getItem('userWishlist'); if (s) this.data.wishlist = new Set(JSON.parse(s)); },
            
            renderMarket() {
                const search = document.getElementById('market-search').value.toLowerCase().trim();
                const grid = document.getElementById('market-grid');
                if(!grid) return;
                
                let results = this.data.marketItems.filter(i => 
                    search ? (i.name.toLowerCase().includes(search) || (i.shortName && i.shortName.toLowerCase().includes(search))) : true
                ).slice(0, 50);

                this.safeUpdateText('market-result-count', `${results.length} RESULTS`);
                grid.innerHTML = results.map(item => {
                    const priceInfo = this.getBestPrice(item.id);
                    return `
                    <div class="tarkov-panel rounded p-3 flex items-center justify-between border border-tarkov-border hover:border-tarkov-blue transition">
                        <div class="flex items-center gap-3">
                            <img src="${item.iconLink}" class="w-10 h-10 bg-black rounded border border-gray-800 object-contain">
                            <div>
                                <h3 class="font-bold text-tarkov-gold text-sm truncate max-w-[150px]">${item.name}</h3>
                                <div class="text-[10px] text-gray-500">${priceInfo.vendor}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold font-mono text-tarkov-blue">₽${priceInfo.price.toLocaleString()}</div>
                        </div>
                    </div>`;
                }).join('');
            },

            renderCrafts() {
                // Minimal implementation for demo
                const grid = document.getElementById('crafts-grid');
                if(grid) grid.innerHTML = '<div class="col-span-full text-center text-gray-500">Crafts loaded (View Simplified)</div>';
            },

            renderTasks() {
                 const grid = document.getElementById('task-list');
                 if(grid && this.data.tasks.length > 0) {
                     grid.innerHTML = this.data.tasks.slice(0, 10).map(t => `<div class="p-2 bg-[#111] rounded border border-[#333] text-gray-400 text-xs">${t.name} (${t.trader.name})</div>`).join('');
                 }
            },

            switchTab(id) {
                ['dashboard', 'injectors', 'market', 'tasks', 'wishlist', 'settings', 'gunsmith', 'ammo', 'hideout'].forEach(t => document.getElementById(`view-${t}`)?.classList.add('hidden'));
                document.getElementById(`view-${id}`)?.classList.remove('hidden');
                
                document.querySelectorAll('.nav-btn-desktop, .nav-btn-mobile').forEach(b => {
                    const active = b.dataset.target === id;
                    if(b.classList.contains('nav-btn-desktop')) {
                        b.classList.toggle('bg-tarkov-border', active);
                        b.classList.toggle('text-tarkov-accent', active);
                        b.classList.toggle('border-tarkov-accent', active);
                        b.classList.toggle('border-transparent', !active);
                    } else {
                        b.classList.toggle('mobile-nav-active', active);
                        b.classList.toggle('text-gray-500', !active);
                    }
                });
            },

            setupListeners() {
                const syncBtn = document.getElementById('sync-btn');
                if(syncBtn) syncBtn.addEventListener('click', () => this.fetchLiveStats());
                
                document.querySelectorAll('.nav-btn-desktop, .nav-btn-mobile, .nav-btn-shortcut').forEach(btn => {
                    btn.addEventListener('click', (e) => this.switchTab(e.currentTarget.dataset.target));
                });
                
                document.querySelectorAll('input[name="gameMode"]').forEach(radio => {
                    radio.addEventListener('change', (e) => this.updateGameMode(e.target.value));
                });
                
                const searchInputs = ['market-search'];
                searchInputs.forEach(id => {
                    document.getElementById(id)?.addEventListener('input', () => this.renderMarket());
                });
            },

            safeUpdateText(id, value) { const el = document.getElementById(id); if (el) el.innerText = value; },
            safeUpdateHTML(id, html) { const el = document.getElementById(id); if (el) el.innerHTML = html; },
            showToast(msg) {
                const t = document.getElementById('toast');
                document.getElementById('toast-msg').innerText = msg;
                t.classList.remove('opacity-0', 'pointer-events-none');
                t.classList.add('animate-bounce');
                setTimeout(() => { t.classList.add('opacity-0', 'pointer-events-none'); t.classList.remove('animate-bounce'); }, 2500);
            }
        };

        app.init();
    </script>
</body>
</html>